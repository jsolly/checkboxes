---
import { Image } from "astro:assets";
import { Code } from "astro:components";

interface Props {
	code: string;
	displayName: string;
	lang?: "javascript" | "typescript" | "vue" | "html" | "css";
	logo?: ImageMetadata;
}

const { code = "", displayName, lang = "javascript", logo } = Astro.props;
const totalLines = code.split("\n").length;
---

<div class="rounded-b-lg overflow-hidden border-x border-b border-slate-200" x-data="{ expanded: false }">
	<button 
		class="w-full bg-slate-50 border-b border-slate-200 px-4 py-2 flex items-center justify-between hover:bg-slate-100 transition-colors"
		@click="expanded = !expanded"
	>
		<div class="flex items-center space-x-3">
			{logo && <Image src={logo} alt={`${displayName} logo`} class="h-5 w-5" />}
			<div class="text-sm text-slate-500">
				<span x-text="expanded ? 'Hide' : 'View'"></span>
				<span> {displayName} code</span>
				<span class="text-xs text-slate-400 ml-2">({totalLines} lines)</span>
			</div>
		</div>
		<div class="text-slate-400">
			<svg 
				xmlns="http://www.w3.org/2000/svg" 
				class="h-5 w-5 transition-transform"
				:class="expanded ? 'rotate-180' : ''"
				fill="none" 
				viewBox="0 0 24 24" 
				stroke="currentColor"
			>
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
			</svg>
		</div>
	</button>
	<div 
		class="overflow-hidden transition-[max-height] duration-300 ease-in-out"
		x-ref="code"
		:style="expanded ? { maxHeight: $refs.code.scrollHeight + 'px' } : { maxHeight: '0px' }"
	>
		<div class="p-4 overflow-x-auto bg-white">
			<Code code={code} lang={lang} theme="github-light" wrap />
		</div>
	</div>
</div> 